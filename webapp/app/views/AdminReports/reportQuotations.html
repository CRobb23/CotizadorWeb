#{extends 'admin.html' /}

#{form @searchQuotations(), class:"form-horizontal", method:"POST", role:"form",id:"reportQuotationForm"}
	
	<div class="well">	
		<div class="orange-title">
			<span>
				<h1>&{'reports.quotations.title'}</h1>
			</span>
		</div>

		#{if flash.error}
			<div class="alert alert-danger">
				${flash.error}
			</div>
		#{/if}
		#{if flash.success}
			<div class="alert alert-success">
				${flash.success}
			</div>
		#{/if}
		
		#{field 'search.export'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-2">
					<input type="checkbox" name="${field.name}" value="export" class="form-control"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'startDate'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" name="${field.name}" value="${field.value}" class="form-control" data-format="DD/MM/YYYY" id="startDatePicker"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'endDate'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" name="${field.name}" value="${field.value}" class="form-control" data-format="DD/MM/YYYY" id="endDatePicker"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.status'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					#{select name:'search.status', id:field.id, value: field.flash, class:'form-control'}
						#{option}&{'form.all'}#{/option}
						#{list items: statuses, as: 'status'}
							#{option status?.id}${status?.name}#{/option}
						#{/list}
					#{/select}
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}

		#{field 'search.origin'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					#{select field.name, id:field.id, value: field.flash, class:'form-control'}
						#{option}&{'form.all'}#{/option}
						#{option}&{'Interno'}#{/option}
						#{option}&{'Corredor'}#{/option}
						#{option}&{'Auto Consulta'}#{/option}
					#{/select}
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.number'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="form-control"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.name'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="form-control"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.inspectionNumber'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="form-control"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.channel'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					#{select field.name, id:field.id, value: field.flash, class:'form-control'}
						#{option}&{'form.all'}#{/option}
						#{list items: channels, as: 'channel'}
							#{option channel?.id}${channel?.name}#{/option}
						#{/list}
					#{/select}
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.broker'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					<input type="text" id="${field.id}" name="${field.name}" value="${field.flash}" class="form-control"/>
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		#{field 'search.isIndividual'}
			<div class="form-group ${field.error?'has-error':''}">
				<label class="col-sm-3 control-label" for="${field.id}">&{'reports.quotations.form.'+field.name}</label>
				<div class="col-sm-6">
					#{select field.name, id:field.id, value: field.flash, class:'form-control'}
						#{option}&{'form.all'}#{/option}
						#{option true}Linea Individual#{/option}
						#{option false}Linea Empresarial#{/option}
					#{/select}
					#{if field.error}<span class="help-block">${field.error}</span>#{/if}
				</div>
			</div>
		#{/}
		
		<div class="form-group">
			<div class="col-sm-offset-3 col-sm-6">
                <span onclick="submit()" class="btn btn-primary btn-block">&{'reports.lostSales.generate'}</span>
			</div>
		</div>
		
	</div>
#{/form}

<div class="well">
	<div class="overflow">

		<div class="table-responsive">
		<table class="table table-striped table-bordered" cellpadding="0" cellspacing="0">
			<thead>
				<tr class="table-head">
					<th class="first">&{'report.quotations.table.quotation.incident.number'}</th>
					<th>&{'report.quotations.table.quotation.incident.broker.name'}</th>
					<th>&{'report.quotations.table.quotation.product.name'}</th>
					<th>&{'report.quotations.table.quotation.incident.vehicle.brand'}</th>
					<th>&{'report.quotations.table.quotation.incident.vehicle.line'}</th>
					<th>&{'report.quotations.table.quotation.incident.vehicle.plate'}</th>
					<th>&{'report.quotations.table.quotation.incident.status.name'}</th>
                    <th class="thMotivo">Motivo</th>
					<th>&{'report.quotations.table.quotation.origin'}</th>
					<th>&{'report.quotations.table.quotation.product.description'}</th>
					<th>&{'report.quotations.table.quotation.incident.inspection.inspectionNumber'}</th>
                    <th>Cliente</th>
                    <th class="thPoliza" >No. Poliza</th>
                    <th class="thFechaPoliza">Fecha de PÃ³liza</th>
                    <th>Tienda</th>



				</tr>
			</thead>
			
			<tbody>
				#{paginate.list items:quotations , as:'current'}
					<tr class="${current_parity}">
						<td class="first style2">${current?.incident?.number}</td>
						<td>
							${current?.incident?.creator?.firstName + ' ' + current?.incident?.creator?.lastName }
						</td>
						<td>
							${current?.product?.name}
						</td>
						<td>
							${current?.incident?.vehicle?.line?.brand?.name} 
						</td>
						<td>
							${current?.incident?.vehicle?.line?.name} 
						</td>
						<td>
							${current?.incident?.vehicle?.plate}
						</td>
						<td>
							${current?.incident?.status?.name}
						</td>
                        <td class="thMotivo">
						${current?.incident?.declinedReason?.description}
                        </td>
						<td>
							${current?.incident?.channel?.name}
						</td>
						<td>
							${current?.product?.description}
						</td>
						<td>
						${current?.incident?.inspection?.inspectionNumber}
                    	</td>
                        <td>
						${current?.incident?.client?.firstName + ' ' + current?.incident?.client?.secondName + ' ' + current?.incident?.client?.firstSurname + ' ' + current?.incident?.client?.secondSurname}
						</td>
                        <td class="thPoliza">
						${current?.incident?.policy}
                        </td>
                        <td class="thFechaPoliza">
						${current?.incident?.policyValidity?.format("dd/MM/yyyy")}
                        </td>
                        <td>
						${current?.incident?.creator?.getStore()}
                        </td>
						
					</tr>
				#{/paginate.list}
			</tbody>
		</table>
		</div>
		
		#{if quotations?.getPageCount() > 1}
			#{paginate.controls items:quotations /}
			<div class="visible-xs text-center">
				#{paginate.summary items:quotations /}
			</div>
		#{/if}
	</div>
</div>


#{set 'moreScripts'}
<script type="text/javascript" src="@{'/public/bootstrap-datetimepicker/js/moment.min.js'}"></script>
<script type="text/javascript" src="@{'/public/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js'}"></script>

<script type="text/javascript">

	$(function () {
		$('#startDatePicker').datetimepicker({
		    locale: "es",
		    format: "DD/MM/YYYY"
		});

		$('#endDatePicker').datetimepicker({
		    locale: "es",
		    format: "DD/MM/YYYY"
		});

		$("#startDatePicker").on("dp.change",function (e) {
		   $('#endDatePicker').data("DateTimePicker").minDate(e.date);
		});

		$("#endDatePicker").on("dp.change",function (e) {
		    $('#startDatePicker').data("DateTimePicker").maxDate(e.date);
		});
	});


    function submit()
    {
        if($("#search_status").val() != "7" && $("#search_status").val() != "")  {
            //do something
            $(".thPoliza").hide();
            $(".thFechaPoliza").hide();
        }
        if(($("#search_status").val() != "8" && $("#search_status").val() != "9") && $("#search_status").val() != "")  {
            //do something
            $(".thMotivo").hide();
        }
        $("#reportQuotationForm").submit();
    }

    $(document).ready(function() {
        if($("#search_status").val() != "7" && $("#search_status").val() != "")  {
            //do something
            $(".thPoliza").hide();
            $(".thFechaPoliza").hide();
        }
        if(($("#search_status").val() != "8" && $("#search_status").val() != "9") && $("#search_status").val() != "")  {
            //do something
            $(".thMotivo").hide();
        }
    });

</script>	            
#{/}